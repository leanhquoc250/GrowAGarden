<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Grow A Garden</title>
<style>
  :root{
    --panel:#fff; --accent:#2fb06f; --muted:#58705f; --bg:#eefdF1;
    --u:#e8fff2; /* Uncommon */
    --c:#eef7ff; /* Common */
    --r:#fff1f7; /* Rare */
    --m:#fff7e6; /* Mythical */
    --d:#f5f0ff; /* Divine */
    --p:#f3fff9; /* Prismatic */
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;background:linear-gradient(180deg,#f2fff5,#f9fffb);color:#0a3b22}
  header{padding:16px 20px;display:flex;gap:12px;align-items:center}
  h1{margin:0;font-size:20px}
  .wrap{max-width:1180px;margin:0 auto;padding:16px;display:flex;gap:16px;align-items:flex-start}
  .panel{background:var(--panel);border-radius:14px;box-shadow:0 10px 26px rgba(12,40,22,.06);padding:14px}
  .left{width:720px}
  .right{flex:1;min-width:300px}
  .top{display:flex;justify-content:space-between;gap:12px}
  .muted{color:var(--muted);font-size:13px}
  .grid{display:grid;grid-template-columns:repeat(8,1fr);gap:10px;padding:10px}
  .tile{height:84px;border-radius:10px;border:1px solid rgba(0,0,0,.06);display:flex;align-items:center;justify-content:center;cursor:pointer;position:relative}
  .tile.locked{opacity:.45;filter:grayscale(.2);cursor:not-allowed}
  .tile .stage{font-size:28px}
  .bar{height:8px;background:#e8f3ec;border-radius:6px;overflow:hidden;width:86%;margin:6px auto 0;box-shadow:inset 0 -2px 0 rgba(0,0,0,.03)}
  .bar>i{display:block;height:100%;background:linear-gradient(90deg,var(--accent),#78d39a);width:0%}
  .selected{outline:3px solid rgba(47,176,111,.2)}
  .controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
  button{border:none;border-radius:10px;padding:8px 12px;font-weight:600;cursor:pointer;background:var(--accent);color:#fff}
  button.secondary{background:#fff;color:var(--accent);border:1px solid rgba(47,176,111,.2)}
  .seed-btn{background:linear-gradient(180deg,#fff,#f6fff8);border:1px solid rgba(0,0,0,.06);border-radius:10px;padding:6px 10px;cursor:pointer}
  .seed-btn.selected{outline:3px solid rgba(47,176,111,.2)}
  .shop-item{display:flex;justify-content:space-between;gap:8px;align-items:center;padding:10px;border:1px solid rgba(0,0,0,.05);border-radius:10px;margin-bottom:8px}
  .badge{background:#fff;border:1px solid rgba(0,0,0,.06);padding:6px 8px;border-radius:8px;font-weight:700}
  .flex{display:flex;gap:8px;align-items:center}
  footer{padding:12px;text-align:center;color:var(--muted)}
  /* m√†u n·ªÅn theo seedType */
  .bg-u{background:linear-gradient(180deg,var(--u),#ddffe9)}
  .bg-c{background:linear-gradient(180deg,var(--c),#e8f3ff)}
  .bg-r{background:linear-gradient(180deg,var(--r),#ffe6f0)}
  .bg-m{background:linear-gradient(180deg,var(--m),#fff0d6)}
  .bg-d{background:linear-gradient(180deg,var(--d),#eee7ff)}
  .bg-p{background:linear-gradient(180deg,var(--p),#e6fff5)}
</style>
</head>
<body>
<header>
  <h1>üåº Grow A Garden</h1>
  <div style="margin-left:auto" class="muted">L∆∞u: localStorage ‚Ä¢ M·ªü file tr·ª±c ti·∫øp</div>
</header>

<div class="wrap">
  <div class="left panel">
    <div class="top">
      <div>
        <div><strong>Ti·ªÅn:</strong> <span id="money">0</span> $</div>
        <div class="muted">T·ªëc ƒë·ªô: <span id="speed">1x</span> ‚Ä¢ Th·ªùi gian: <span id="time">0</span>s</div>
      </div>
      <div class="muted">Ch·ªçn √¥ ‚Üí Ch·ªçn lo·∫°i h·∫°t b√™n ph·∫£i ‚Üí Tr·ªìng</div>
    </div>

    <div style="margin-top:10px">
      <div id="garden" class="grid"></div>
    </div>

    <div class="controls">
      <button id="plantBtn">üå± Tr·ªìng</button>
      <button id="plantAllBtn" class="secondary">üå± Tr·ªìng t·∫•t c·∫£</button>
      <button id="waterBtn" class="secondary">üíß T∆∞·ªõi</button>
      <button id="harvestBtn" class="secondary">üß∫ Thu ho·∫°ch</button>
      <button id="harvestAllBtn" class="secondary">üß∫ Thu ho·∫°ch t·∫•t c·∫£</button>
      <button id="storeHarvestBtn" class="secondary">üì¶ L∆∞u v√†o kho</button>
      <button id="buyTileBtn" class="secondary">üõí Mua √¥ m·ªõi (200$)</button>
      <button id="skipBtn" class="secondary">‚è≠Ô∏è +5s</button>
    </div>
  </div>

  <div class="right">
    <div class="panel">
      <h3 style="margin:0 0 8px">Shop ‚Äî Mua H·∫°t</h3>

      <!-- 6 n√∫t ch·ªçn lo·∫°i h·∫°t -->
      <div style="display:flex;flex-wrap:wrap;gap:8px;margin-bottom:10px">
        <button class="seed-btn selected" data-type="u">üå± Uncommon<br><span class="muted">Gi√°: 10$</span></button>
        <button class="seed-btn" data-type="c">üåø Common<br><span class="muted">Gi√°: 50$</span></button>
        <button class="seed-btn" data-type="r">üå∏ Rare<br><span class="muted">Gi√°: 100$</span></button>
        <button class="seed-btn" data-type="m">üå∑ Mythical<br><span class="muted">Gi√°: 5000$</span></button>
        <button class="seed-btn" data-type="d">üåª Divine<br><span class="muted">Gi√°: 10000$</span></button>
        <button class="seed-btn" data-type="p">üí† Prismatic<br><span class="muted">Gi√°: 1000000$</span></button>
      </div>

      <!-- 6 n√∫t mua -->
      <div id="buyList"></div>

      <hr style="border:none;height:8px">

      <h4 style="margin:6px 0">Gear</h4>
      <div class="shop-item">
        <div><strong>B√¨nh t∆∞·ªõi x·ªãn</strong><div class="muted">+20% hi·ªáu qu·∫£ t∆∞·ªõi (c·ªông d·ªìn)</div></div>
        <button id="buy_sprayer">Mua 250$</button>
      </div>
      <div class="shop-item">
        <div><strong>Cu·ªëc x·ªãn</strong><div class="muted">+20% gi√° b√°n tr√°i c√¢y</div></div>
        <button id="buy_shovel">Mua 350$</button>
      </div>

      <hr style="border:none;height:8px">

      <h4 style="margin:6px 0">Kho tr√°i c√¢y</h4>
      <div class="flex" style="flex-direction:column;gap:6px" id="invBox"></div>
      <div class="flex" style="margin-top:8px">
        <button id="sellAllBtn">üí∞ B√°n t·∫•t c·∫£</button>
        <div class="muted" style="margin-left:auto" id="priceNote"></div>
      </div>
    </div>

    <div class="panel" style="margin-top:12px">
      <h3 style="margin:0 0 8px">Chi ti·∫øt √¥</h3>
      <div id="tileInfo" class="muted">Ch·ªçn m·ªôt √¥ ƒë·ªÉ xem</div>
    </div>
  </div>
</div>

<footer class="panel">Made with üíö ‚Ä¢ B·∫£n 6 lo·∫°i h·∫°t</footer>

<script>
/* ======= C·∫§U H√åNH 6 LO·∫†I H·∫†T ======= */
const SEEDS = {
  // key: {name, icon, price, grow, sell, tileClass}
  u:{name:'Uncommon', icon:'üå±', price:10,     grow:15,   sell:10*4,     tileClass:'bg-u'},
  c:{name:'Common',   icon:'üåø', price:50,     grow:30,   sell:50*4,     tileClass:'bg-c'},
  r:{name:'Rare',     icon:'üå∏', price:100,    grow:60,   sell:100*4,    tileClass:'bg-r'},
  m:{name:'Mythical', icon:'üå∑', price:5000,   grow:300,  sell:5000*4,   tileClass:'bg-m'},
  d:{name:'Divine',   icon:'üåª', price:10000,  grow:600,  sell:10000*4,  tileClass:'bg-d'},
  p:{name:'Prismatic',icon:'üí†', price:1000000,grow:3600, sell:1000000*4,tileClass:'bg-p'}
};
const ORDER = ['u','c','r','m','d','p'];

const CONFIG = {
  rows:4, cols:8, initialUnlocked:12,
  sprayer_price:250, shovel_price:350,
  start_money:1000,
  startSeeds:{u:2,c:1,r:0,m:0,d:0,p:0},
  buyTilePrice:200
};

/* ======= STATE ======= */
const state = {
  money: CONFIG.start_money,
  seeds: {u:0,c:0,r:0,m:0,d:0,p:0},
  inventory: {u:0,c:0,r:0,m:0,d:0,p:0},
  sprayerLevel:0, shovelLevel:0,
  time:0, speed:1,
  selected:'u',
  tiles:[], selectedTile:null
};
// init seeds
Object.keys(CONFIG.startSeeds).forEach(k=>state.seeds[k]=CONFIG.startSeeds[k]);

/* ======= DOM ======= */
const garden = document.getElementById('garden');
const moneyEl = document.getElementById('money');
const speedEl = document.getElementById('speed');
const timeEl = document.getElementById('time');
const tileInfo = document.getElementById('tileInfo');
const buyList = document.getElementById('buyList');
const invBox = document.getElementById('invBox');
const priceNote = document.getElementById('priceNote');

/* ======= GRID ======= */
const total = CONFIG.rows*CONFIG.cols;
for(let i=0;i<total;i++){
  state.tiles.push({locked: i>=CONFIG.initialUnlocked, planted:false, type:null, progress:0, plantedAt:0});
}
function renderGrid(){
  garden.innerHTML='';
  state.tiles.forEach((t,i)=>{
    const d=document.createElement('div');
    const cls = t.locked ? '' : (t.planted ? SEEDS[t.type].tileClass : 'bg-u');
    d.className = `tile ${cls}` + (t.locked?' locked':'') + (state.selectedTile===i?' selected':'');
    d.dataset.index=i;
    if(t.locked){
      d.innerHTML='<div class="muted" style="text-align:center">üîí<div>Kh√≥a</div></div>';
    }else if(!t.planted){
      d.innerHTML='<div class="stage">üíß</div>';
    }else{
      const p=t.progress;
      const face = p<.25?'üå±':p<.6?'üåø':p<.95?'üåº':'üåª';
      const label = `${SEEDS[t.type].icon} ${SEEDS[t.type].name}`;
      d.innerHTML=`<div style="text-align:center"><div class="stage">${face}</div>
      <div class="muted" style="font-size:12px">${label}</div>
      <div class="bar"><i style="width:${Math.round(p*100)}%"></i></div></div>`;
    }
    d.onclick=()=>{state.selectedTile=i; showTile(i); renderGrid();};
    garden.appendChild(d);
  });
}
function showTile(i){
  const t=state.tiles[i];
  if(!t){tileInfo.textContent='Kh√¥ng t√¨m th·∫•y √¥.';return;}
  if(t.locked){tileInfo.innerHTML=`<strong>√î ${i+1}</strong> ‚Äî üîí ƒëang kh√≥a`;return;}
  if(!t.planted){tileInfo.innerHTML=`<strong>√î ${i+1}</strong> ‚Äî Tr·ªëng`;return;}
  const remain=Math.max(0,Math.ceil((1-t.progress)*(SEEDS[t.type].grow/state.speed)));
  tileInfo.innerHTML = `<strong>√î ${i+1}</strong><div>Lo·∫°i: ${SEEDS[t.type].name}</div>
  <div>Ti·∫øn tr√¨nh: ${Math.round(t.progress*100)}%</div><div>C√≤n: ${remain}s</div>`;
}

/* ======= SELECT BUTTONS ======= */
document.querySelectorAll('.seed-btn').forEach(btn=>{
  btn.addEventListener('click',()=>{
    document.querySelectorAll('.seed-btn').forEach(b=>b.classList.remove('selected'));
    btn.classList.add('selected');
    state.selected = btn.dataset.type;
  });
});

/* ======= SHOP LIST (BUY BUTTONS) ======= */
function renderBuy(){
  buyList.innerHTML='';
  ORDER.forEach(k=>{
    const s=SEEDS[k];
    const row=document.createElement('div');
    row.className='shop-item';
    row.innerHTML=`<div><strong>${s.icon} ${s.name}</strong>
      <div class="muted">+1 h·∫°t (${s.price}$) ‚Ä¢ Tr∆∞·ªüng th√†nh ${s.grow}s ‚Ä¢ B√°n ${s.sell}$</div></div>
      <div><button data-k="${k}">Mua ${s.price}$</button></div>`;
    row.querySelector('button').onclick=()=>{
      if(state.money < s.price){alert('Kh√¥ng ƒë·ªß ti·ªÅn.');return;}
      state.money -= s.price; state.seeds[k]++; ding('buy'); save(); renderAll();
    };
    buyList.appendChild(row);
  });
  // note gi√° b√°n
  priceNote.textContent = 'Gi√° b√°n: ' + ORDER.map(k=>`${SEEDS[k].name} ${SEEDS[k].sell}$`).join(' ‚Ä¢ ');
}

/* ======= INVENTORY ======= */
function renderInventory(){
  invBox.innerHTML='';
  ORDER.forEach(k=>{
    const line=document.createElement('div');
    line.className='flex';
    line.innerHTML=`<div style="flex:1">${SEEDS[k].icon} ${SEEDS[k].name}</div>
                    <div class="badge" id="inv_${k}">${state.inventory[k]}</div>`;
    invBox.appendChild(line);
  });
}

/* ======= CONTROLS ======= */
document.getElementById('plantBtn').onclick=()=>{
  const i=state.selectedTile;
  if(i==null){alert('Ch·ªçn √¥ tr∆∞·ªõc.');return;}
  const t=state.tiles[i];
  if(t.locked){alert('√î ƒëang kh√≥a.');return;}
  if(t.planted){alert('√î ƒë√£ c√≥ c√¢y.');return;}
  const k=state.selected;
  if(state.seeds[k]<=0){alert('Kh√¥ng ƒë·ªß h·∫°t.');return;}
  state.seeds[k]--; t.planted=true; t.type=k; t.progress=0; t.plantedAt=state.time;
  ding('plant'); save(); renderAll();
};
document.getElementById('waterBtn').onclick=()=>{
  const i=state.selectedTile;
  if(i==null){alert('Ch·ªçn √¥.');return;}
  const t=state.tiles[i];
  if(t.locked||!t.planted){alert('√î kh√¥ng c√≥ c√¢y.');return;}
  const eff=0.12*(1+state.sprayerLevel*0.2);
  t.progress=Math.min(1, t.progress+eff);
  ding('water'); save(); renderAll();
};
document.getElementById('harvestBtn').onclick=()=>harvestOne(true);
document.getElementById('storeHarvestBtn').onclick=()=>harvestOne(true);
function harvestOne(toInv){
  const i=state.selectedTile;
  if(i==null){alert('Ch·ªçn √¥.');return;}
  const t=state.tiles[i];
  if(t.locked||!t.planted){alert('√î kh√¥ng c√≥ c√¢y.');return;}
  if(t.progress<0.95){alert('Ch∆∞a ch√≠n.');return;}
  state.inventory[t.type]++; t.planted=false; t.type=null; t.progress=0;
  ding('harvest'); save(); renderAll();
}
document.getElementById('harvestAllBtn').onclick=()=>{
  let cnt=0;
  state.tiles.forEach(t=>{
    if(!t.locked && t.planted && t.progress>=0.95){
      state.inventory[t.type]++; t.planted=false; t.progress=0; t.type=null; cnt++;
    }
  });
  if(!cnt){alert('Kh√¥ng c√≥ c√¢y n√†o ƒë√£ ch√≠n.');return;}
  ding('harvest'); save(); renderAll();
};
document.getElementById('plantAllBtn').onclick=()=>{
  let planted=0, k=state.selected;
  state.tiles.forEach(t=>{
    if(!t.locked && !t.planted && state.seeds[k]>0){
      state.seeds[k]--; t.planted=true; t.type=k; t.progress=0; t.plantedAt=state.time; planted++;
    }
  });
  if(!planted){alert('H·∫øt √¥ tr·ªëng ho·∫∑c kh√¥ng ƒë·ªß h·∫°t.');return;}
  ding('plant'); save(); renderAll();
};
document.getElementById('skipBtn').onclick=()=>{
  state.time+=5; sim(5); save(); renderAll();
};
document.getElementById('buyTileBtn').onclick=()=>{
  const price=CONFIG.buyTilePrice;
  if(state.money<price){alert('Kh√¥ng ƒë·ªß ti·ªÅn.');return;}
  const idx=state.tiles.findIndex(t=>t.locked);
  if(idx===-1){alert('T·∫•t c·∫£ √¥ ƒë√£ m·ªü.');return;}
  state.money-=price; state.tiles[idx].locked=false; ding('buy'); save(); renderAll();
};
document.getElementById('buy_sprayer').onclick=()=>{
  if(state.money<CONFIG.sprayer_price){alert('Kh√¥ng ƒë·ªß ti·ªÅn.');return;}
  state.money-=CONFIG.sprayer_price; state.sprayerLevel++; ding('buy'); save(); renderAll();
};
document.getElementById('buy_shovel').onclick=()=>{
  if(state.money<CONFIG.shovel_price){alert('Kh√¥ng ƒë·ªß ti·ªÅn.');return;}
  state.money-=CONFIG.shovel_price; 
  state.shovelLevel++; 
  CONFIG.shovel_price *= 2; // tƒÉng g·∫•p ƒë√¥i gi√° sau m·ªói l·∫ßn mua
  document.getElementById('buy_shovel').textContent = `Mua ${CONFIG.shovel_price}$`; // c·∫≠p nh·∫≠t gi√° hi·ªÉn th·ªã
  ding('buy'); 
  save(); 
  renderAll();
};

document.getElementById('sellAllBtn').onclick=()=>{
  let total=0; const bonus=1+state.shovelLevel*0.2;
  ORDER.forEach(k=>{ total += state.inventory[k]*SEEDS[k].sell*bonus; state.inventory[k]=0; });
  if(total===0){alert('Kho tr·ªëng.');return;}
  state.money += Math.round(total); ding('sell'); save(); renderAll();
};

/* ======= SIM ======= */
function sim(dt){
  state.tiles.forEach(t=>{
    if(!t.locked && t.planted){
      const need = SEEDS[t.type].grow/state.speed;
      t.progress=Math.min(1, t.progress + dt/need);
    }
  });
}
setInterval(()=>{state.time++; sim(1); save(); renderAll();},1000);

/* ======= RENDER ======= */
function renderAll(){
  renderGrid(); renderBuy(); renderInventory();
  moneyEl.textContent = state.money;
  speedEl.textContent = state.speed.toFixed(2)+'x';
  timeEl.textContent = state.time;
  if(state.selectedTile!=null) showTile(state.selectedTile);
}

/* ======= AUDIO (nh·∫π) ======= */
let ac; function ensureAC(){ ac = ac || new (window.AudioContext||window.webkitAudioContext)(); }
function beep(f,d=0.08,t='sine'){ try{ ensureAC(); const o=ac.createOscillator(), g=ac.createGain();
  o.type=t; o.frequency.value=f; o.connect(g); g.connect(ac.destination);
  g.gain.setValueAtTime(.0001,ac.currentTime); g.gain.exponentialRampToValueAtTime(.2,ac.currentTime+.01);
  o.start(); g.gain.exponentialRampToValueAtTime(.0001,ac.currentTime+d); o.stop(ac.currentTime+d+.02);}catch(e){} }
function ding(name){
  if(name==='water') beep(900,.06,'triangle');
  else if(name==='harvest'){beep(660,.08);beep(880,.06);}
  else if(name==='plant') beep(520,.06);
  else if(name==='buy') beep(740,.05,'square');
  else if(name==='sell'){beep(440,.12);beep(660,.06);}
}

/* ======= SAVE/LOAD ======= */
const SAVE_KEY='garden6_v1';
function save(){ try{ localStorage.setItem(SAVE_KEY, JSON.stringify(state)); }catch(e){} }
function load(){
  try{
    const raw=localStorage.getItem(SAVE_KEY); if(!raw) return;
    const s=JSON.parse(raw);
    Object.assign(state,seedsSafe(state,s));
  }catch(e){}
}
function seedsSafe(def,s){
  const safe = JSON.parse(JSON.stringify(def));
  ['money','sprayerLevel','shovelLevel','time','speed','selected','selectedTile'].forEach(k=>{
    if(s[k]!=null) safe[k]=s[k];
  });
  if(s.seeds) ORDER.forEach(k=> safe.seeds[k]=s.seeds[k]??safe.seeds[k]);
  if(s.inventory) ORDER.forEach(k=> safe.inventory[k]=s.inventory[k]??safe.inventory[k]);
  if(Array.isArray(s.tiles) && s.tiles.length===def.tiles.length) safe.tiles=s.tiles;
  return safe;
}

/* ======= START ======= */



load();
renderAll();
</script>
</body>
</html>
