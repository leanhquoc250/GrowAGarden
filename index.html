<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Grow A Garden</title>
<style>
  :root{
    --panel:#fff; --accent:#2fb06f; --muted:#58705f; --bg:#eefdF1;
    --u:#e8fff2; /* Uncommon */
    --c:#eef7ff; /* Common */
    --r:#fff1f7; /* Rare */
    --m:#fff7e6; /* Mythical */
    --d:#f5f0ff; /* Divine */
    --p:#f3fff9; /* Prismatic */
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;background:linear-gradient(180deg,#f2fff5,#f9fffb);color:#0a3b22}
  header{padding:16px 20px;display:flex;gap:12px;align-items:center}
  h1{margin:0;font-size:20px}
  .wrap{max-width:1180px;margin:0 auto;padding:16px;display:flex;gap:16px;align-items:flex-start}
  .panel{background:var(--panel);border-radius:14px;box-shadow:0 10px 26px rgba(12,40,22,.06);padding:14px}
  .left{width:720px}
  .right{flex:1;min-width:300px}
  .top{display:flex;justify-content:space-between;gap:12px}
  .muted{color:var(--muted);font-size:13px}
  .grid{display:grid;grid-template-columns:repeat(8,1fr);gap:10px;padding:10px}
  .tile{height:84px;border-radius:10px;border:1px solid rgba(0,0,0,.06);display:flex;align-items:center;justify-content:center;cursor:pointer;position:relative}
  .tile.locked{opacity:.45;filter:grayscale(.2);cursor:not-allowed}
  .tile .stage{font-size:28px}
  .bar{height:8px;background:#e8f3ec;border-radius:6px;overflow:hidden;width:86%;margin:6px auto 0;box-shadow:inset 0 -2px 0 rgba(0,0,0,.03)}
  .bar>i{display:block;height:100%;background:linear-gradient(90deg,var(--accent),#78d39a);width:0%}
  .selected{outline:3px solid rgba(47,176,111,.2)}
  .controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
  button{border:none;border-radius:10px;padding:8px 12px;font-weight:600;cursor:pointer;background:var(--accent);color:#fff}
  button.secondary{background:#fff;color:var(--accent);border:1px solid rgba(47,176,111,.2)}
  .seed-btn{background:linear-gradient(180deg,#fff,#f6fff8);border:1px solid rgba(0,0,0,.06);border-radius:10px;padding:6px 10px;cursor:pointer}
  .seed-btn.selected{outline:3px solid rgba(47,176,111,.2)}
  .shop-item{display:flex;justify-content:space-between;gap:8px;align-items:center;padding:10px;border:1px solid rgba(0,0,0,.05);border-radius:10px;margin-bottom:8px}
  .badge{background:#fff;border:1px solid rgba(0,0,0,.06);padding:6px 8px;border-radius:8px;font-weight:700}
  .flex{display:flex;gap:8px;align-items:center}
  footer{padding:12px;text-align:center;color:var(--muted)}
  /* màu nền theo seedType */
  .bg-u{background:linear-gradient(180deg,var(--u),#ddffe9)}
  .bg-c{background:linear-gradient(180deg,var(--c),#e8f3ff)}
  .bg-r{background:linear-gradient(180deg,var(--r),#ffe6f0)}
  .bg-m{background:linear-gradient(180deg,var(--m),#fff0d6)}
  .bg-d{background:linear-gradient(180deg,var(--d),#eee7ff)}
  .bg-p{background:linear-gradient(180deg,var(--p),#e6fff5)}
</style>
</head>
<body>

<!-- MÀN HÌNH ĐĂNG NHẬP -->
<div id="loginScreen" style="position:fixed;top:0;left:0;width:100%;height:100%;background:#f4f4f4;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:9999;font-family:sans-serif">
  <h2>🌼 Grow A Garden — Beta</h2>
  <input id="username" placeholder="Tên đăng nhập" style="padding:8px;margin:6px;font-size:16px">
  <input id="password" type="password" placeholder="Mật khẩu" style="padding:8px;margin:6px;font-size:16px">
  <button id="loginBtn" style="padding:8px 16px;margin-top:8px">Đăng nhập</button>
  <p id="loginMsg" style="color:red;margin-top:8px"></p>
  <hr style="width:200px;margin:10px 0">
<h3>Đăng ký tài khoản mới</h3>
<input id="newUser" placeholder="Tên đăng nhập mới" style="padding:8px;margin:6px;font-size:16px">
<input id="newPass" type="password" placeholder="Mật khẩu mới" style="padding:8px;margin:6px;font-size:16px">
<label><input type="checkbox" id="newBeta"> Tham gia Beta</label><br>
<button id="registerBtn" style="padding:8px 16px;margin-top:8px">Đăng ký</button>
<p id="registerMsg" style="color:blue;margin-top:8px"></p>

</div>
<!-- HẾT PHẦN ĐĂNG NHẬP -->

<header>
  <h1>🌼 Grow A Garden</h1>
  <div style="margin-left:auto" class="muted">Lưu: localStorage • Mở file trực tiếp</div>
</header>


<div class="wrap">
  <div class="left panel">
    <div class="top">
      <div>
        <div><strong>Tiền:</strong> <span id="money">0</span> $</div>
        <div class="muted">Tốc độ: <span id="speed">1x</span> • Thời gian: <span id="time">0</span>s</div>
      </div>
      <div class="muted">Chọn ô → Chọn loại hạt bên phải → Trồng</div>
    </div>

    <div style="margin-top:10px">
      <div id="garden" class="grid"></div>
    </div>

    <div class="controls">
      <button id="plantBtn">🌱 Trồng</button>
      <button id="plantAllBtn" class="secondary">🌱 Trồng tất cả</button>
      <button id="waterBtn" class="secondary">💧 Tưới</button>
	  <button id="waterAllBtn" class="secondary">💧 Tưới tất cả</button>
      <button id="harvestBtn" class="secondary">🧺 Thu hoạch</button>
      <button id="harvestAllBtn" class="secondary">🧺 Thu hoạch tất cả</button>
      <button id="storeHarvestBtn" class="secondary">📦 Lưu vào kho</button>
      <button id="buyTileBtn" class="secondary">🛒 Mua ô mới (200$)</button>
      <button id="skipBtn" class="secondary">⏭️ +5s</button>
    </div>
  </div>

  <div class="right">
    <div class="panel">
      <h3 style="margin:0 0 8px">Shop — Mua Hạt</h3>

      <!-- 6 nút chọn loại hạt -->
      <div style="display:flex;flex-wrap:wrap;gap:8px;margin-bottom:10px">
        <button class="seed-btn selected" data-type="u">🌱 Uncommon<br><span class="muted">Giá: 10$</span></button>
        <button class="seed-btn" data-type="c">🌿 Common<br><span class="muted">Giá: 50$</span></button>
        <button class="seed-btn" data-type="r">🌸 Rare<br><span class="muted">Giá: 100$</span></button>
        <button class="seed-btn" data-type="m">🌷 Mythical<br><span class="muted">Giá: 5000$</span></button>
        <button class="seed-btn" data-type="d">🌻 Divine<br><span class="muted">Giá: 10000$</span></button>
        <button class="seed-btn" data-type="p">💠 Prismatic<br><span class="muted">Giá: 1000000$</span></button>
      </div>

      <!-- 6 nút mua -->
      <div id="buyList"></div>

      <hr style="border:none;height:8px">

      <h4 style="margin:6px 0">Gear</h4>
      <div class="shop-item">
        <div><strong>Bình tưới xịn</strong><div class="muted">+20% hiệu quả tưới (cộng dồn)</div></div>
        <button id="buy_sprayer">Mua 250$</button>
      </div>
      <div class="shop-item">
        <div><strong>Cuốc xịn</strong><div class="muted">+20% giá bán trái cây</div></div>
        <button id="buy_shovel">Mua 350$</button>
      </div>

      <hr style="border:none;height:8px">

      <h4 style="margin:6px 0">Kho trái cây</h4>
      <div class="flex" style="flex-direction:column;gap:6px" id="invBox"></div>
      <div class="flex" style="margin-top:8px">
        <button id="sellAllBtn">💰 Bán tất cả</button>
        <div class="muted" style="margin-left:auto" id="priceNote"></div>
      </div>
    </div>

    <div class="panel" style="margin-top:12px">
      <h3 style="margin:0 0 8px">Chi tiết ô</h3>
      <div id="tileInfo" class="muted">Chọn một ô để xem</div>
    </div>
  </div>
</div>

<footer class="panel">Made with 💚 • Bản 6 loại hạt</footer>

<script>
/* ======= CẤU HÌNH 6 LOẠI HẠT ======= */
const SEEDS = {
  // key: {name, icon, price, grow, sell, tileClass}
  u:{name:'Uncommon', icon:'🌱', price:10,     grow:15,   sell:10*4,     tileClass:'bg-u'},
  c:{name:'Common',   icon:'🌿', price:50,     grow:30,   sell:50*4,     tileClass:'bg-c'},
  r:{name:'Rare',     icon:'🌸', price:100,    grow:60,   sell:100*4,    tileClass:'bg-r'},
  m:{name:'Mythical', icon:'🌷', price:5000,   grow:300,  sell:5000*4,   tileClass:'bg-m'},
  d:{name:'Divine',   icon:'🌻', price:10000,  grow:600,  sell:10000*4,  tileClass:'bg-d'},
  p:{name:'Prismatic',icon:'💠', price:1000000,grow:3600, sell:1000000*4,tileClass:'bg-p'}
};
const ORDER = ['u','c','r','m','d','p'];

const CONFIG = {
  rows:12, cols:8, initialUnlocked:12,
  sprayer_price:250, shovel_price:350,
  start_money:1000,
  startSeeds:{u:2,c:1,r:0,m:0,d:0,p:0},
  buyTilePrice:200
};



/* ======= STATE ======= */
const state = {
  money: CONFIG.start_money,
  seeds: {u:0,c:0,r:0,m:0,d:0,p:0},
  inventory: {u:0,c:0,r:0,m:0,d:0,p:0},
  sprayerLevel:0, shovelLevel:0,
  time:0, speed:1,
  selected:'u',
  tiles:[], selectedTile:null
};
// init seeds
Object.keys(CONFIG.startSeeds).forEach(k=>state.seeds[k]=CONFIG.startSeeds[k]);

/* ======= DOM ======= */
const garden = document.getElementById('garden');
const moneyEl = document.getElementById('money');
const speedEl = document.getElementById('speed');
const timeEl = document.getElementById('time');
const tileInfo = document.getElementById('tileInfo');
const buyList = document.getElementById('buyList');
const invBox = document.getElementById('invBox');
const priceNote = document.getElementById('priceNote');

/* ======= GRID ======= */
const total = CONFIG.rows*CONFIG.cols;
for(let i=0;i<total;i++){
  state.tiles.push({locked: i>=CONFIG.initialUnlocked, planted:false, type:null, progress:0, plantedAt:0});
}
function renderGrid(){
  garden.innerHTML='';
  state.tiles.forEach((t,i)=>{
    const d=document.createElement('div');
    const cls = t.locked ? '' : (t.planted ? SEEDS[t.type].tileClass : 'bg-u');
    d.className = `tile ${cls}` + (t.locked?' locked':'') + (state.selectedTile===i?' selected':'');
    d.dataset.index=i;
    if(t.locked){
      d.innerHTML='<div class="muted" style="text-align:center">🔒<div>Khóa</div></div>';
    }else if(!t.planted){
      d.innerHTML='<div class="stage">💧</div>';
    }else{
      const p=t.progress;
      const face = p<.25?'🌱':p<.6?'🌿':p<.95?'🌼':'🌻';
      const label = `${SEEDS[t.type].icon} ${SEEDS[t.type].name}`;
      d.innerHTML=`<div style="text-align:center"><div class="stage">${face}</div>
      <div class="muted" style="font-size:12px">${label}</div>
      <div class="bar"><i style="width:${Math.round(p*100)}%"></i></div></div>`;
    }
    d.onclick=()=>{state.selectedTile=i; showTile(i); renderGrid();};
    garden.appendChild(d);
  });
}
function showTile(i){
  const t=state.tiles[i];
  if(!t){tileInfo.textContent='Không tìm thấy ô.';return;}
  if(t.locked){tileInfo.innerHTML=`<strong>Ô ${i+1}</strong> — 🔒 đang khóa`;return;}
  if(!t.planted){tileInfo.innerHTML=`<strong>Ô ${i+1}</strong> — Trống`;return;}
  const remain=Math.max(0,Math.ceil((1-t.progress)*(SEEDS[t.type].grow/state.speed)));
  tileInfo.innerHTML = `<strong>Ô ${i+1}</strong><div>Loại: ${SEEDS[t.type].name}</div>
  <div>Tiến trình: ${Math.round(t.progress*100)}%</div><div>Còn: ${remain}s</div>`;
}

/* ======= SELECT BUTTONS ======= */
document.querySelectorAll('.seed-btn').forEach(btn=>{
  btn.addEventListener('click',()=>{
    document.querySelectorAll('.seed-btn').forEach(b=>b.classList.remove('selected'));
    btn.classList.add('selected');
    state.selected = btn.dataset.type;
  });
});

/* ======= SHOP LIST (BUY BUTTONS) ======= */
function renderBuy(){
  buyList.innerHTML='';
  ORDER.forEach(k=>{
    const s=SEEDS[k];
    const row=document.createElement('div');
    row.className='shop-item';
    row.innerHTML=`<div><strong>${s.icon} ${s.name}</strong>
      <div class="muted">+1 hạt (${s.price}$) • Trưởng thành ${s.grow}s • Bán ${s.sell}$</div></div>
      <div><button data-k="${k}">Mua ${s.price}$</button></div>`;
    row.querySelector('button').onclick=()=>{
      if(state.money < s.price){alert('Không đủ tiền.');return;}
      state.money -= s.price; state.seeds[k]++; ding('buy'); save(); renderAll();
    };
    buyList.appendChild(row);
  });
  // note giá bán
  priceNote.textContent = 'Giá bán: ' + ORDER.map(k=>`${SEEDS[k].name} ${SEEDS[k].sell}$`).join(' • ');
}

/* ======= INVENTORY ======= */
function renderInventory(){
  invBox.innerHTML='';
  ORDER.forEach(k=>{
    const line=document.createElement('div');
    line.className='flex';
    line.innerHTML=`<div style="flex:1">${SEEDS[k].icon} ${SEEDS[k].name}</div>
                    <div class="badge" id="inv_${k}">${state.inventory[k]}</div>`;
    invBox.appendChild(line);
  });
}

/* ======= CONTROLS ======= */
document.getElementById('plantBtn').onclick=()=>{
  const i=state.selectedTile;
  if(i==null){alert('Chọn ô trước.');return;}
  const t=state.tiles[i];
  if(t.locked){alert('Ô đang khóa.');return;}
  if(t.planted){alert('Ô đã có cây.');return;}
  const k=state.selected;
  if(state.seeds[k]<=0){alert('Không đủ hạt.');return;}
  state.seeds[k]--; t.planted=true; t.type=k; t.progress=0; t.plantedAt=state.time;
  ding('plant'); save(); renderAll();
};
document.getElementById('waterBtn').onclick=()=>{
  const i=state.selectedTile;
  if(i==null){alert('Chọn ô.');return;}
  const t=state.tiles[i];
  if(t.locked||!t.planted){alert('Ô không có cây.');return;}
  const eff=0.12*(1+state.sprayerLevel*0.2);
  t.progress=Math.min(1, t.progress+eff);
  ding('water'); save(); renderAll();
};
document.getElementById('waterAllBtn').onclick=()=>{
  let watered = 0;
  state.tiles.forEach(t=>{
    if(!t.locked && t.planted){
      const eff = 0.12*(1+state.sprayerLevel*0.2);
      t.progress = Math.min(1, t.progress+eff);
      watered++;
    }
  });
  if(!watered){
    alert('Không có cây nào để tưới.');
    return;
  }
  ding('water'); save(); renderAll();
};

document.getElementById('harvestBtn').onclick=()=>harvestOne(true);
document.getElementById('storeHarvestBtn').onclick=()=>harvestOne(true);
function harvestOne(toInv){
  const i=state.selectedTile;
  if(i==null){alert('Chọn ô.');return;}
  const t=state.tiles[i];
  if(t.locked||!t.planted){alert('Ô không có cây.');return;}
  if(t.progress<0.95){alert('Chưa chín.');return;}
  state.inventory[t.type]++; t.planted=false; t.type=null; t.progress=0;
  ding('harvest'); save(); renderAll();
}
document.getElementById('harvestAllBtn').onclick=()=>{
  let cnt=0;
  state.tiles.forEach(t=>{
    if(!t.locked && t.planted && t.progress>=0.95){
      state.inventory[t.type]++; t.planted=false; t.progress=0; t.type=null; cnt++;
    }
  });
  if(!cnt){alert('Không có cây nào đã chín.');return;}
  ding('harvest'); save(); renderAll();
};
document.getElementById('plantAllBtn').onclick=()=>{
  let planted=0, k=state.selected;
  state.tiles.forEach(t=>{
    if(!t.locked && !t.planted && state.seeds[k]>0){
      state.seeds[k]--; t.planted=true; t.type=k; t.progress=0; t.plantedAt=state.time; planted++;
    }
  });
  if(!planted){alert('Hết ô trống hoặc không đủ hạt.');return;}
  ding('plant'); save(); renderAll();
};
document.getElementById('skipBtn').onclick=()=>{
  state.time+=5; sim(5); save(); renderAll();
};
document.getElementById('buyTileBtn').onclick=()=>{
  const price=CONFIG.buyTilePrice;
  if(state.money<price){alert('Không đủ tiền.');return;}
  const idx=state.tiles.findIndex(t=>t.locked);
  if(idx===-1){alert('Tất cả ô đã mở.');return;}
  state.money-=price; state.tiles[idx].locked=false; ding('buy'); save(); renderAll();
};
document.getElementById('buy_sprayer').onclick=()=>{
  if(state.money<CONFIG.sprayer_price){alert('Không đủ tiền.');return;}
  state.money-=CONFIG.sprayer_price; state.sprayerLevel++; ding('buy'); save(); renderAll();
};
document.getElementById('buy_shovel').onclick=()=>{
  if(state.money<CONFIG.shovel_price){alert('Không đủ tiền.');return;}
  state.money-=CONFIG.shovel_price; 
  state.shovelLevel++; 
  CONFIG.shovel_price *= 2; // tăng gấp đôi giá sau mỗi lần mua
  document.getElementById('buy_shovel').textContent = `Mua ${CONFIG.shovel_price}$`; // cập nhật giá hiển thị
  ding('buy'); 
  save(); 
  renderAll();
};

document.getElementById('sellAllBtn').onclick=()=>{
  let total=0; const bonus=1+state.shovelLevel*0.2;
  ORDER.forEach(k=>{ total += state.inventory[k]*SEEDS[k].sell*bonus; state.inventory[k]=0; });
  if(total===0){alert('Kho trống.');return;}
  state.money += Math.round(total); ding('sell'); save(); renderAll();
};

/* ======= SIM ======= */
function sim(dt){
  state.tiles.forEach(t=>{
    if(!t.locked && t.planted){
      const need = SEEDS[t.type].grow/state.speed;
      t.progress=Math.min(1, t.progress + dt/need);
    }
  });
}
setInterval(()=>{state.time++; sim(1); save(); renderAll();},1000);

/* ======= RENDER ======= */
function renderAll(){
  renderGrid(); renderBuy(); renderInventory();
  moneyEl.textContent = state.money;
  speedEl.textContent = state.speed.toFixed(2)+'x';
  timeEl.textContent = state.time;
  if(state.selectedTile!=null) showTile(state.selectedTile);
}

/* ======= AUDIO (nhẹ) ======= */
let ac; function ensureAC(){ ac = ac || new (window.AudioContext||window.webkitAudioContext)(); }
function beep(f,d=0.08,t='sine'){ try{ ensureAC(); const o=ac.createOscillator(), g=ac.createGain();
  o.type=t; o.frequency.value=f; o.connect(g); g.connect(ac.destination);
  g.gain.setValueAtTime(.0001,ac.currentTime); g.gain.exponentialRampToValueAtTime(.2,ac.currentTime+.01);
  o.start(); g.gain.exponentialRampToValueAtTime(.0001,ac.currentTime+d); o.stop(ac.currentTime+d+.02);}catch(e){} }
function ding(name){
  if(name==='water') beep(900,.06,'triangle');
  else if(name==='harvest'){beep(660,.08);beep(880,.06);}
  else if(name==='plant') beep(520,.06);
  else if(name==='buy') beep(740,.05,'square');
  else if(name==='sell'){beep(440,.12);beep(660,.06);}
}

/* ====== Khởi tạo tài khoản từ localStorage ====== */
let ACCOUNTS = JSON.parse(localStorage.getItem("accounts") || "[]");

// Nếu chưa có tài khoản mẫu, thêm vào
if (ACCOUNTS.length === 0) {
  ACCOUNTS = [
    {user: "admin", pass: "1234", beta: true},
    {user: "quoc", pass: "matkhau", beta: false}
  ];
  localStorage.setItem("accounts", JSON.stringify(ACCOUNTS));
}

let currentUser = null;
let SAVE_KEY = null;

/* ====== Đăng nhập ====== */
document.getElementById('loginBtn').onclick = () => {
  const u = document.getElementById('username').value.trim();
  const p = document.getElementById('password').value.trim();
  const acc = ACCOUNTS.find(a => a.user === u && a.pass === p);

  if (!acc) {
    document.getElementById('loginMsg').textContent = "❌ Sai tên hoặc mật khẩu!";
    return;
  }
  if (!acc.beta) {
    document.getElementById('loginMsg').textContent = "🚫 Tài khoản này chưa tham gia chương trình beta!";
    return;
  }

  currentUser = acc.user;
  SAVE_KEY = "garden6_beta_" + currentUser;

  load();
  renderAll();
  document.getElementById('loginScreen').style.display = "none";
};

/* ====== Đăng ký ====== */
document.getElementById('registerBtn').onclick = () => {
  const u = document.getElementById('newUser').value.trim();
  const p = document.getElementById('newPass').value.trim();
  const b = document.getElementById('newBeta').checked;

  if (!u || !p) {
    document.getElementById('registerMsg').textContent = "⚠️ Vui lòng nhập đủ tên và mật khẩu!";
    return;
  }
  if (ACCOUNTS.find(a => a.user === u)) {
    document.getElementById('registerMsg').textContent = "⚠️ Tên đăng nhập đã tồn tại!";
    return;
  }

  ACCOUNTS.push({ user: u, pass: p, beta: b });
  localStorage.setItem("accounts", JSON.stringify(ACCOUNTS)); // lưu vào localStorage
  document.getElementById('registerMsg').textContent = "✅ Đăng ký thành công! Giờ bạn có thể đăng nhập.";
};

/* ====== SAVE / LOAD riêng cho từng tài khoản ====== */
function save(){ 
  if (!SAVE_KEY) return;
  try { localStorage.setItem(SAVE_KEY, JSON.stringify(state)); }catch(e){} 
}
function load(){
  if (!SAVE_KEY) return;
  try{
    const raw=localStorage.getItem(SAVE_KEY); 
    if(!raw) return;
    const s=JSON.parse(raw);
    Object.assign(state,seedsSafe(state,s));
  }catch(e){}
}


function seedsSafe(def,s){
  const safe = JSON.parse(JSON.stringify(def));
  ['money','sprayerLevel','shovelLevel','time','speed','selected','selectedTile'].forEach(k=>{
    if(s[k]!=null) safe[k]=s[k];
  });
  if(s.seeds) ORDER.forEach(k=> safe.seeds[k]=s.seeds[k]??safe.seeds[k]);
  if(s.inventory) ORDER.forEach(k=> safe.inventory[k]=s.inventory[k]??safe.inventory[k]);
  if(Array.isArray(s.tiles) && s.tiles.length===def.tiles.length) safe.tiles=s.tiles;
  return safe;
}

/* ======= START ======= */



load();
renderAll();
</script>
</body>
</html>
